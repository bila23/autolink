<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition  xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" template="./../template/noAdminTemplate.xhtml" xmlns:p="http://primefaces.org/ui" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:a="http://xmlns.jcp.org/jsf/passthrough" xmlns:of="http://omnifaces.org/functions">
    <ui:define name="content">
        <style>
            .ui-selectonemenu{
                width: 100% !important
            }
        </style>
        <h:form id="mf">
            <div class="row">
                <div class="col s12">
                    <p:growl globalOnly="true" id="msg" showDetail="true"/>
                    <p:tabView scrollable="true" id="tab">
                        <p:ajax event="tabChange" listener="#{provSolController.onTabChange}" update="mf:msg dtdpp dtcoa dtgoc"/>
                        <p:tab title="COTIZACION ABIERTA" id="coa">
                            <p:dataTable emptyMessage="No hay solicitudes" id="dtcoa" var="r1" value="#{provSolController.solList}" rows="6" paginator="true">
                                <f:facet name="header">
                                    Haga clic para ver los repuestos y generar su oferta
                                </f:facet>
                                <p:column style="width:16px">
                                    <p:rowToggler />
                                </p:column>
                                <p:column headerText="Inicio" sortBy="#{r1.fechainicio}" style="text-align:center">
                                    #{of:formatDate(r1.fechainicio, 'dd/MM/yyyy HH:mm:ss')}
                                </p:column>
                                <p:column headerText="Inicio" sortBy="#{r1.fechafin}" style="text-align:center">
                                    #{of:formatDate(r1.fechafin, 'dd/MM/yyyy HH:mm:ss')}
                                </p:column>
                                <p:column headerText="Codigo" sortBy="#{r1.codigosolicitud}">
                                    <h:outputText value="#{r1.codigosolicitud}" />
                                </p:column>
                                <p:column headerText="Marca" sortBy="#{r1.marca}">
                                    <h:outputText value="#{r1.marca}" />
                                </p:column>
                                <p:column headerText="Modelo" sortBy="#{r1.modelo}">
                                    <h:outputText value="#{r1.modelo}" />
                                </p:column>
                                <p:column headerText="Comentario aseguradora" sortBy="#{r1.comentariosaseguradora}">
                                    <h:outputText value="#{r1.comentariosaseguradora}" />
                                </p:column>
                                <p:rowExpansion>
                                    <p:dataTable emptyMessage="No hay repuestos" var="r11" value="#{r1.repAplicaList}">
                                        <p:column headerText="Repuesto">
                                            <h:outputText value="#{r11.repuesto}" />
                                        </p:column>
                                        <p:column headerText="Estado">
                                            <h:outputText value="#{r11.estadoOferta}" />
                                        </p:column>
                                        <p:column headerText="Tiempo">
                                            <h:outputText value="#{r11.tiempo}" />
                                        </p:column>
                                        <p:column headerText="Precio">
                                            <h:outputText value="#{r11.precio}" />
                                        </p:column>
                                        <p:column style="text-align:center;width: 16px">
                                            <p:commandLink actionListener="#{provSolController.prepareOferta(r11.idsolicitud, r11.idrepuesto)}" update="mf:pgOferta" onsuccess="PF('dlgOferta').show()">
                                                <i class="material-icons">content_paste</i>
                                            </p:commandLink>
                                        </p:column>
                                    </p:dataTable>
                                </p:rowExpansion>
                            </p:dataTable>
                        </p:tab>
                        <p:tab title="GENERADOR ORDEN DE COMPRA" id="goc">
                            <p:dataTable emptyMessage="No hay solicitudes" id="dtgoc" var="r1" value="#{provSolController.solList}" rows="6" paginator="true">
                                <p:column headerText="Inicio" sortBy="#{r1.fechainicio}" style="text-align:center">
                                    #{of:formatDate(r1.fechainicio, 'dd/MM/yyyy HH:mm:ss')}
                                </p:column>
                                <p:column headerText="Inicio" sortBy="#{r1.fechafin}" style="text-align:center">
                                    #{of:formatDate(r1.fechafin, 'dd/MM/yyyy HH:mm:ss')}
                                </p:column>
                                <p:column headerText="Codigo" sortBy="#{r1.codigosolicitud}">
                                    <h:outputText value="#{r1.codigosolicitud}" />
                                </p:column>
                                <p:column headerText="Marca" sortBy="#{r1.marca}">
                                    <h:outputText value="#{r1.marca}" />
                                </p:column>
                                <p:column headerText="Modelo" sortBy="#{r1.modelo}">
                                    <h:outputText value="#{r1.modelo}" />
                                </p:column>
                                <p:column headerText="Comentario aseguradora" sortBy="#{r1.comentariosaseguradora}">
                                    <h:outputText value="#{r1.comentariosaseguradora}" />
                                </p:column>
                                <p:column headerText="Ver piezas" style="width:8%;text-align: center">
                                    <p:commandLink actionListener="#{asegSolController.showRepAplica(r1.id)}" update="mf:msg mf:repSolTable" onsuccess="PF('dlgRep').show()">
                                        <i class="material-icons">content_paste</i>
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                        <p:tab title="DESPACHADA POR PROVEEDOR" id="dpp">
                            <p:dataTable emptyMessage="No hay solicitudes" id="dtdpp" var="r1" value="#{provSolController.solList}" rows="6" paginator="true">
                                <p:column headerText="Inicio" sortBy="#{r1.fechainicio}" style="text-align:center">
                                    #{of:formatDate(r1.fechainicio, 'dd/MM/yyyy HH:mm:ss')}
                                </p:column>
                                <p:column headerText="Inicio" sortBy="#{r1.fechafin}" style="text-align:center">
                                    #{of:formatDate(r1.fechafin, 'dd/MM/yyyy HH:mm:ss')}
                                </p:column>
                                <p:column headerText="Codigo" sortBy="#{r1.codigosolicitud}">
                                    <h:outputText value="#{r1.codigosolicitud}" />
                                </p:column>
                                <p:column headerText="Marca" sortBy="#{r1.marca}">
                                    <h:outputText value="#{r1.marca}" />
                                </p:column>
                                <p:column headerText="Modelo" sortBy="#{r1.modelo}">
                                    <h:outputText value="#{r1.modelo}" />
                                </p:column>
                                <p:column headerText="Comentario aseguradora" sortBy="#{r1.comentariosaseguradora}">
                                    <h:outputText value="#{r1.comentariosaseguradora}" />
                                </p:column>
                                <p:column headerText="Ver piezas" style="width:8%;text-align: center">
                                    <p:commandLink actionListener="#{asegSolController.showRepAplica(r1.id)}" update="mf:msg mf:repSolTable" onsuccess="PF('dlgRep').show()">
                                        <i class="material-icons">content_paste</i>
                                    </p:commandLink>
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                    </p:tabView>
                </div>
            </div>
            <p:dialog widgetVar="dlgRep" id="dlgRep" modal="true" closeOnEscape="true" header="Repuestos de Solicitud" dynamic="true" width="290px">
                <p:dataTable emptyMessage="No hay repuestos" id="repSolTable" var="r1" value="#{asegSolController.repSolList}">
                    <p:column headerText="Repuesto" sortBy="#{r1.repuesto}">
                        <h:outputText value="#{r1.repuesto}" />
                    </p:column>
                </p:dataTable>
            </p:dialog>
            <p:dialog widgetVar="dlgOferta" id="dlgOferta" modal="true" closeOnEscape="true" header="Generar oferta" dynamic="true">
                <h:panelGroup id="pgOferta">
                    <div class="row">
                        <div class="col s12 input-field">
                            <div>Estado:</div>
                            <p:selectOneMenu value="#{provSolController.vo.estado}" class="validate" id="estado">
                                <f:selectItem itemLabel="Nuevo" itemValue="Nuevo"/>
                                <f:selectItem itemLabel="Usado" itemValue="Usado"/>
                            </p:selectOneMenu>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12 input-field">
                            <div>Precio:</div>
                            <h:inputText value="#{provSolController.vo.precio}" class="validate" id="precio"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12 input-field">
                            <div>Tiempo:</div>
                            <h:inputText value="#{provSolController.vo.tiempo}" class="validate" id="tiempo"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12 input-field">
                            <p:commandButton value="Guardar" class="waves-effect waves-light btn" actionListener="#{provSolController.saveOferta()}" update="mf:msg mf:tab:dtcoa"/>
                        </div>
                    </div>
                </h:panelGroup>
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>